<script>
  const PRICE_LABEL = { "UNDER_10":"do 10 €","UNDER_15":"do 15 €","OVER_20":"20+ €" };

  function render(data){
    document.getElementById('date').textContent =
      new Date(data.date).toLocaleDateString('sk-SK', { weekday:'long', year:'numeric', month:'long', day:'numeric' });

    function blockList(el, title, section){
      const items = section?.menu || [];
      const list = items.length
        ? `<ul style="margin:8px 0 0 18px;padding:0">${items.map(i => `<li>${i}</li>`).join('')}</ul>`
        : `<div class="row"><span class="tag">—</span></div>`;

      el.innerHTML = `
        <h2>${title}</h2>
        <div class="row">
          <span class="tag price">${PRICE_LABEL[section?.priceBand] || '—'}</span>
        </div>
        ${list}
      `;
    }

    blockList(document.getElementById('ndegust'), 'Ndegust', data.ndegust);
    blockList(document.getElementById('umedveda'), 'U Medveďa', data.umedveda);

    const tips = Array.isArray(data.tips) ? data.tips : [];
    document.getElementById('tips').innerHTML = tips.map(t => {
      const price = `<span class="tag price" style="margin-left:8px">${PRICE_LABEL[t.priceBand] || '—'}</span>`;
      const link = t.url ? ` <a href="${t.url}" target="_blank" rel="noopener" style="margin-left:8px;color:#f5c451;text-decoration:none">zdroj ↗</a>` : '';
      return `<li><strong>${t.name}</strong> – ${t.dish || 'špecialita'}${price}${link}</li>`;
    }).join('');
  }

  fetch('./data.json?cache=' + Date.now())
    .then(r => { if (!r.ok) throw new Error('Nepodarilo sa načítať data.json ('+r.status+')'); return r.json(); })
    .then(d => render(d))
    .catch(err => {
      console.error(err);
      const fallback = {
        date: new Date().toISOString().slice(0,10),
        ndegust: { menu: [], priceBand: "UNDER_10" },
        umedveda: { menu: [], priceBand: "UNDER_15" },
        tips: []
      };
      render(fallback);
      const footer = document.querySelector('footer');
      footer.innerHTML += ` • <span style="color:#f5c451">Pozn.: ${err.message}</span>`;
    });
</script>
